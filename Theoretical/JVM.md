# JVM



## 概念

### JDK（Java Development Kit）

是用于开发 Java 程序的完整套件，包含 JRE 和开发工具

- javac：将字符源码编译为字节码，也就是将 .java 文件编译为 .class 文件
- javadoc：从源码的 `/**...*/` 注释自动生成 API 文档
- jar：将 Java 程序打包为一个 .jar 文件，以及从 .jar 文件解包为 Java 程序
- jdb：命令行调试器，连接 JVM，支持断点、单步、打印变量、线程控制等操作

### JRE（Java Runtime Environment）

是用于运行 Java 程序的运行环境，包含 JVM 和标准类库

- java.base：包含 lang、util、io、nio 等，是 Java 程序的核心依赖类
- java.sql：提供数据库连接和 SQL 操作的标准接口

### JVM（Java Virtual Machine） 

是用于运行 Java 字节码（.class 文件）的虚拟机，通过封装底层硬件平台的差异，使得 Java 程序可以在不同平台运行

- 解释器（interpreter）：运行时逐条读取字节码并按语义直接在宿主上执行，不会为字节码生成本地机器码
- JIT（Just-In-Time）：在运行时把热点字节码编译为机器码并缓存

### 关系

<img src="https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/Java/202509162330784.png" alt="image-20250916233051698" style="zoom: 50%;" />



##内存

### 进程内存结构

JVM 内存：由 JVM 管理的内存，是预先设置好初始值和最大值的内存，主要有堆和线程

本地内存：由进程管理的内存，是从操作系统动态分配的内存，主要有元空间和直接内存

<img src="https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/Java/202509162331896.png" alt="image-20250916233140809" style="zoom: 50%;" />



### 线程

#### 内存结构

线程是 JVM 中执行代码的最小单位，每个线程都有自己的执行上下文和内存空间，同时也与其他线程共享堆和本地内存

<img src="https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/Java/202509162332105.png" alt="image-20250916233237006" style="zoom:50%;" />

#### 程序计数器

程序计数器（Program Counter Register）记录了线程当前执行字节码的地址，也可以记录下一行字节码的地址

- 每个线程都有自己的程序计数器
- 解释器根据程序计数器来读取并执行下一步操作
- 解释器也可以调整程序计数器来实现控制代码流程
- 当线程切换时，程序计数器保留了线程执行位置，以便切换回来后恢复执行

#### 虚拟机栈

虚拟机栈：简称栈，是每个 Java 线程私有的内存区域，生命周期和线程一致，负责存放方法执行的栈帧，用于方法调用、局部变量保存、操作数计算和控制流管理

栈帧：每次方法调用时都会创建一个栈帧压入该线程的栈，方法返回时弹出并销毁该栈帧，每个栈帧包含局部变量表、操作数栈、动态链接、方法返回地址

- 局部变量表：存放了编译期可知的方法参数、局部基本类型变量和对象引用，用于按索引快速访问方法数据，并作为字节码指令的读写目标
- 操作数栈：存放方法执行过程中产生的临时数据与中间结果，用于字节码通过 LIFO 完成运算操作数的传递和返回值处理
- 动态链接：存放当前栈帧能访问的运行时常量池中的符号引用，用于在运行时将符号引用解析为直接引用，从而快速定位调用目标
- 方法返回地址：存放当前方法的调用方在字节码中的返回位置，用于在当前方法执行完后能够返回调用点继续执行

<img src="https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/Java/202509162340065.png" alt="image-20250916234039981" style="zoom:50%;" />




















































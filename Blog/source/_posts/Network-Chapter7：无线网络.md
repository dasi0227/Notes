---
title: 无线网络
tags:
  - Network
categories:
  - 笔记
cover: /image/network.png
abbrlink: 6938a174
date: 2024-10-09 10:21:49
description: 无线网络、无线链路、CDMA，WiFi、局域网、蓝牙
---
<meta name="referrer" content="no-referrer"/>

## 1. 无线网络

### 1.1 概念

**无线站点（wireless host）**：运行应用程序的端系统设备，可以是智能手机、平板电脑、物联网设备等，可以移动也可以不移动

**无线链路（wireless link）**：无线站点通过无线链路连接到基站或其他无线站点，主要特性包括**传播速率（数据传输速度）**和**覆盖区域（信号可覆盖的范围）**

**基站（base station）**：负责在无线网络中与无线站点进行数据的发送和接收，如蜂窝网络中的**蜂窝塔**或802.11无线局域网中的**接入点**

**关联**：无线站点在基站的无线覆盖范围内，并通过该基站进行与更大网络之间的数据中继

**切换（handoff/handover）**：在移动设备移动过程中，网络系统将设备的连接从一个基站切换到另一个基站的过程

![](https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/ComputerNetwork/chapter7/202410091811313.png)

### 1.2 模式

|模式|架构|特点|适用|
|-|-|-|-|
|基础设施（infrastructure）|无线站点通过基站与网络连接，基站充当中心节点，负责管理和转发数据|扩展性高，可以增加基站来扩展网络覆盖范围|家庭网络、校园网络、企业环境和公共场所，提供稳定的无线连接|
|自组织网络（ad hoc network）|无线站点之间通过无线链路直接通信，不需要中心节点或接入点|灵活性高，节点可以自由加入或离开网络|灾难救援、军事通信、短期活动，无需固定基础设施，易于快速部署|

|分类|结构|特点|例子|
|-|-|-|-|
|单跳无基础设施|所有无线站点直接彼此通信|小范围|蓝牙网络|
|单跳有基础设施|无线站点通过基站与其他无线站点通信|高扩展|家庭WiFi|
|多跳无基础设施|无线站点通过多个中间节点与其他无线站点通信|自组织|车载网络|
|多跳有基础设施|无线站点通过多个基站与其他无线站点通信|大范围|4G/5G，企业WiFi|

## 2. 无线链路

### 2.1 效率

|特征|描述|因素|
|-|-|-|
|递减的信号强度|电磁波在传播过程中，其强度会随着距离的增加而递减，又称为路径损耗（path loss）|距离、介质、频率|
|来自其他源的干扰|在同一频段内，来自其他信号源的电磁波对目标信号形成干扰|频段重叠、环境噪声、多用户环境|
|多路径传播|电磁波经过反射、折射或散射，导致接收方收到来自不同路径的多个信号|位置的动态变化、物理环境|

**信噪比（Signal-to-Noise Ratio, SNR）**：收到的信号和噪声强度的相对测量，单位是分贝（dB），**SNR越大信号质量越好**

**比特差错率（Bit Error Rate, BER）**：接收方收到的有错传输比特的概率

**比特传输速率（Bit Rate, BR）**：单位时间内传输的比特数量，单位是每秒传输比特数（bps），不同的**调制技术**有不同的数据传输效率

![](https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/ComputerNetwork/chapter7/202410091811311.png)

- **对于给定的调制技术，SNR越高，BER越低**：较高的SNR能提供更清晰的信号，使得解调过程中的噪声影响减小
- **对于给定的SNR，调制技术的BR越高，BER越高**：较高的BR能够传输更多比特，但同时出错的概率也会越大
- **自适应调制（Adaptive Modulation）**：物理层可以根据当前信道条件动态选择适合的调制技术

### 2.2 CDMA

**码片多址（Code Division Multiple Access, CDMA）**：是一种无线通信技术，允许多个用户在同一频段上同时传输数据
1. 将每个**比特时间**再划分为 m 个短的时间槽，称为**码片（chip）**
2. 每个节点被指派一个唯一的 m 位码片序列
3. 每个节点发送比特1，则发送它的码片序列，发送比特0，则发送它的码片序列的反码
4. 来自不同节点的码片序列进行线性相加得到比特序列，实现同时传输
5. 接收方使用节点相同码片序列进行解码，从而提取来自不同用户的数据

{% note warning flat %}
实现CDMA的前提：
1. 码片序列切换的速度要远远大于比特序列到达的速率
2. 码片序列之间是相互正交的
{% endnote %}

数学原理：**规格化内积**，用于衡量两个向量的相似性
- 码片序列a和码片序列a的规格化内积是1（完全正相关）
- 码片序列a和码片反序列a‘的的规格化内积是-1（完全负相关）
- 码片序列a和与其正交的码片序列b的规格化内积是0（完全不相关）

![](https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/ComputerNetwork/chapter7/202410091811309.png)

{% note success flat %}
码片序列为：
A：(-1 -1 -1 +1 +1 -1 +1 +1) 
B：(-1 -1 +1 -1 +1 +1 +1 -1)
C：(-1 +1 -1 +1 +1 +1 -1 -1) 
D：(-1 +1 -1 -1 -1 -1 +1 -1)
假设发送的比特序列是：
X：(+1 -3 +3 -1 +1 +1 +1 +1)
可以得到：
A：1/8(-1+3-3-1+1-1+1+1)=0，表示A没有发送数据
B：1/8(-1+3+3+1+1+1+1-1)=1，表示B发送比特1
C：1/8(-1-3-3-1+1+1-1-1)=-1，表示C发送比特0
D：1/8(-1-3-3+1-1-1+1-1)=-1，表示D发送比特0
{% endnote %}

## 3. WiFi

**WiFi（Wireless Fidelity）**：无线保真技术，是一种基于 IEEE 802.11 标准的无线局域网技术
- **接入点（Access Point, AP）**：是无线站点接入互联网的接口
- **基本服务集（Basic Service Set, BSS）**：是 WiFi 网络的最小组成单元，由一个 AP 和与其关联的无线站点组成
- **关联（Association）**：是无线站点与接入点之间建立的一条虚拟链路，只有成功关联的站点才能通过 AP 发送和接收数据帧
- **信道号（channel number）**：无线频段被分为多条信道，当且仅当**相隔4个信道**时传输才不会重叠，WiFi 工作在 2.4GHz 和 5GHz 两个频段
- **服务集标识符（Service Set Identifier, SSID）**：无线网络的名称，用户通过 SSID 选择并连接到无线网络

{% note warning flat %}
一个 AP 可以提供多个 WiFI，但是一个 BSS 只能对应一个 WiFi
{% endnote %}

**WiFi 工作原理**
1. AP 通过无线电波广播 WiFi 信号
2. 无限站点扫描可用的 SSID，并选择目标网络进行连接
3. 无限站点发送连接请求，AP 验证无限站点身份，无限站点与 AP 建立连接，通过协议分配 IP 地址
4. 无限站点通过无线电波向 AP 传输数据，AP 在无线网络和有线网络之间转发数据

![](https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/ComputerNetwork/chapter7/202410091811307.png)

无线站点与AP：
- 如何知晓：**被动监听**或**主动探测**
- 如何选择：**信号强度（RSSI）**或**负载情况**
- 如何关联：无限站点发送**关联请求帧**，AP返回**关联响应帧**

## 4. 802.11

### 4.1 隐藏终端

在无线网络中，每个无线站点之间可能无法直接检测到彼此的存在，导致它们同时发送数据，引发信道冲突和性能下降
- 无线信号范围有限：设备的通信范围有限，无法覆盖所有其他设备
- 非对称传输功率：设备的传输功率不同，导致通信范围不对称
- 物理障碍：墙壁、建筑物等障碍物阻挡信号，进一步限制通信范围

![](https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/ComputerNetwork/chapter7/202410091811310.png)

![](https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/ComputerNetwork/chapter7/202410091811305.png)

### 4.2 RTS/CTS

原理
- RTS（Request to Send）：是无线站点发送数据前向接入点单播的请求帧，向接入段请求/预约信道的使用权
- CTS（Clear to Send）：是接入点在收到 RTS 后广播的确认帧，通知请求的无线站点信道可用，通知其他站点信道将被占用，避免冲突
- 分布式帧间间隔（Distributed Inter-Frame Space, DIFS）：发送**RTS、数据**前需要等待的最小时间间隔，用于确保信道长时间处于空闲，而不是瞬时空闲，**最大程度避免可能的碰撞**
- 短帧间间隔（Short Inter-Frame Space,SIFS）：发送**CTS、ACK**前需要等待的最小时间间隔，确保在发送方能最快发送关键帧的前提下，接收方有足够的时间来处理关键帧

流程
1. 站点检测信道空闲，等待 DIFS
2. 如果等待 DIFS 后信道繁忙，进入退避机制
3. 如果等待 DIFS 后信道空闲，发送 RTS 帧
4. AP 收到 RTS 帧，等待 SIFS，发送 CTS 帧
5. 站点收到 CTS 帧，等待 SIFS，发送数据帧
6. AP 收到数据帧，等待 SIFS，发送 ACK 帧

![](https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/ComputerNetwork/chapter7/202410091811304.png)

### 4.3 帧结构

帧结构
|字段|长度/字节|描述|
|-|-|-|
|帧控制|2|用于区分帧|
|持续期|2|表示该帧和接收ACK帧所需的时间，用于RTS/CTS的机制|
|目的地址|6|接收设备的MAC地址|
|源地址|6|发送设备的MAC地址|
|BSSID|6|BSS接入路由器的MAC地址|
|序号控制|2|帧的序列号，用于排序和重组|
|有效载荷|0-2312|实际要发送的数据，通常是IP数据报或ARP分组|
|CRC|4|循环冗余校验码，用于检测帧在传输过程中的错误|

![](https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/ComputerNetwork/chapter7/202410091811302.png)

帧控制
|字段|长度/比特|描述|
|-|-|-|
|协议版本|2|通常为0表示IEEE 802.11|
|类型|2|指示主要类型：管理帧、控制帧或数据帧|
|子类型|4|进一步细分帧的类型，比如关联请求/响应，RTS/CTS等|
|到AP|1|指示当前帧是否发往AP|
|从AP|1|指示当前帧是否来自AP|
|更多标识|1|在分片传输中使用，用于告知接收方，后续还有更多片段需要接收|
|重试|1|表示当前帧是一个重传帧，用于确保可靠传输|
|功率管理|1|指示设备是否处于功率节省模式|
|更多数据|1|在流量控制中使用，告诉接收方是否还有更多数据待发送|
|WEP|1|指示当前帧是否使用了WEP加密|
|保留|1|供将来使用，通常设置为0|

### 4.4 相同子网的移动性

1. 信号强度评估：检测到AP1的RSSI越来越小，AP2的RSSI值越来越大
2. 切换连接：向AP1发送一个**去关联请求**，向AP2发送一个**关联请求**
3. 会话保持：如果新的BSS和旧的BSS都属于同一子网，那么站点会通过DHCP**续租原先的IP地址**，并**维持正在进行的会话**
4. 更新表项：AP2会广播一个以太网帧，更新交换机/路由器以通告站点连接至新AP

![](https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/ComputerNetwork/chapter7/202410091811301.png)

### 4.5 高级特色

|特色|描述|
|-|-|
|快速漫游|允许用户在不同接入点之间迅速切换而不会中断连接|
|速率自适应|根据当前和近期的信道特点来选择合适的物理层的调制技术，提高数据传输的可靠性和效率|
|功率管理|接入点在没有帧要发送和接收时能够进入低功耗/睡眠状态，从而节省能源|

## 5. 蓝牙

**蓝牙（Bluetooth）**：是一种**短距离低功耗无线通信**技术，又被称为**无线个人区域网络（Wireless Personal Area Network,WPAN）**和**微微网（piconet）**，工作在**2.4GHz**工业、科学和医疗频段，与Wi-Fi等其他无线技术共享同一频段

**跳频扩频（Frequency Hopping Spread Spectrum,FHSS）**：以**固定**的时隙625微秒，发送方和接收方在79个信道频率之间按照预定的跳频序列进行**快速同步切换**，使得信号能够在多个频段中扩展
- **抗干扰**：由于信号在多个频率上分布，因此如果某些频率受到干扰，数据仍可以通过其他未受影响的频率传输，从而显著降低通信失败的概率
- **安全**：由于频率不断变化，攻击者难以锁定信号传输路径，从而提高了通信的安全性
- **多设备**：由于不同设备使用不同的跳频序列，从而允许多个设备在相同时间内使用不同频段工作而不互相干扰

自组织性
|设备|功能|
|-|-|
|主控设备|负责控制和管理蓝牙网络，发起连接和数据传输|
|客户设备|响应主设备的请求，与主设备进行数据交换|
|寄放设备|处于休眠状态，不与主设备通信，保持配对信息以便未来连接|

![](https://dasi-blog.oss-cn-guangzhou.aliyuncs.com/ComputerNetwork/chapter7/202410091811299.png)

流程
1. **邻居发现（Neighbor Discovery）**
   1. 主控设备广播32条**询问信号**，每条都在不同的频道上，并重复传输序列128次
   2. 客户设备在它选择的频道上监听，一旦监听到询问信号，客户设备会在隔一个随机时间量后主动发送**响应信号**
   3. 主控设备接收到响应信号后，会更新其设备列表，显示所有发现的可连接设备
2. **蓝牙寻呼（Bluetooth Paging）**
   1. 主控设备选定客户设备，发送**寻呼信号**，通知客户要使用的跳频模式以及时钟信息
   2. 客户设备接收到寻呼信号后，回复**响应信号**
   3. 主控设备接收到响应信号后，将使用之前指定的跳频模式与客户设备进行通信

{% note success flat %}
iPhone连接AirPods，iPhone就是主控设备
- 邻居发现阶段允许iPhone识别周围的AirPods，并将其标记为寄放设备
- 用户在iPhone的蓝牙列表中选择连接AirPods
- 蓝牙寻呼阶段允许iPhone连接AirPods，使AirPods成为客户设备并开始进行数据传输
{% endnote %}
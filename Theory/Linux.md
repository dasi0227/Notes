# Linux



   * [基本概念](#基本概念)
      * [Linux 内核](#linux-内核)
      * [Linux 发行版](#linux-发行版)
   * [命令](#命令)
      * [定义](#定义)
      * [命令提示符](#命令提示符)
      * [格式](#格式)
      * [执行过程](#执行过程)
   * [文件系统](#文件系统)
      * [文件信息](#文件信息)
      * [目录结构](#目录结构)
   * [环境变量](#环境变量)
      * [定义](#定义)
      * [存储位置](#存储位置)
      * [相关命令](#相关命令)
   * [基本命令](#基本命令)
      * [文件管理](#文件管理)
         * [ls](#ls)
         * [cd](#cd)
         * [rm](#rm)
         * [cp](#cp)
         * [touch](#touch)
         * [mv](#mv)
      * [文本管理](#文本管理)
         * [cat](#cat)
         * [grep](#grep)
         * [sort](#sort)
         * [wc](#wc)
      * [权限管理](#权限管理)
         * [chmod](#chmod)
         * [chown](#chown)
         * [umask](#umask)
      * [用户管理](#用户管理)
         * [useradd](#useradd)
         * [userdel](#userdel)
         * [usermod](#usermod)
         * [passwd](#passwd)
      * [用户组管理](#用户组管理)
         * [groupadd](#groupadd)
         * [groupdel](#groupdel)
         * [groupmod](#groupmod)
      * [进程管理](#进程管理)
         * [kill](#kill)
         * [ps](#ps)
         * [systemctl](#systemctl)
   * [软件包管理](#软件包管理)
      * [格式](#格式)
      * [选项](#选项)
      * [命令](#命令)
   * [系统信息查询](#系统信息查询)



## 基本概念

### Linux 内核

Linux 是由芬兰人**林纳斯·本纳第克特·托瓦兹 Linus Benedict Torvalds** 创建的操作系统内核，继承了 Unix 的**多用户、多任务、多线程**等设计，常用于**服务器**的操作系统

- **开源免费**：遵循 GPL 协议，源代码完全开放，企业可以根据自己需求魔改系统
- **轻量高效**：系统组件模块化，可按需裁剪，无需图形界面即可运行，占用资源少，性能高
- **安全稳定**：基于多用户、多权限设计，普通用户与系统权限严格隔离，极少崩溃，长期运行稳定
- **自动化**：原生支持 Shell 脚本，方便进行系统管理、任务调度、部署和监控等自动化操作
- **网络功能强大**：：内置完整的 TCP/IP 协议栈和丰富的网络命令工具

### Linux 发行版

上述 Linux 只是指内核，现在所讲的 Linux 实际上指的是 Linux 发行版，最常见的有 Ubuntu 和 CentOS，而 **Linux 发行版 = Kernel + GNU + Shell + GUI+ Package Manager + Application**等组件组合而成的完整操作系统

| **组成部分**        | **作用说明**                                                 | **典型例子**                     |
| ------------------- | ------------------------------------------------------------ | -------------------------------- |
| **Kernel**          | 提供操作系统的核心，负责进程调度、内存管理、文件系统、设备驱动、网络通信等底层功能，构成内核空间的基础运行环境 | Linux Kernel                     |
| **GNU**             | 提供系统库与工具链，负责用户与内核之间的交互，构成用户空间的基础运行环境 | 包含 glibc、bash、coreutils、gcc |
| **Shell**           | 命令行解释器：将文本命令转化为机器指令                       | bash、zsh、sh                    |
| **GUI**             | 图形化用户界面：让用户以图形方式操作系统                     | GNOME、KDE                       |
| **Package Manager** | 包管理器：管理软件的安装、更新、卸载及依赖关系               | apt、yum、dnf                    |
| **Application**     | 应用程序：提供具体功能和服务                                 | vim、ssh、nginx、firefox         |



## 命令

### 定义

命令 Command：**是用户控制内核和系统行为的基本交互单位，大多数命令实际上都是由 C 语言编写的程序，经过编译后封装为可执行的 ELF 文件**，由操作系统通过系统调用加载并执行

终端 Terminal：**是一个交互界面**，本身不会执行命令，而是启动一个 Shell 进程，接收用户的键盘输入，将命令程序的执行结果输出到屏幕

外壳 Shell：**是运行在用户态的命令解释器，作为连接用户命令与操作系统内核之间的桥梁**，既可以执行内建命令，也可以执行外部命令

- 内建命令：由 Shell 自身实现，执行直接调用函数，不需要创建新进程，如 cd、echo、export 等
- 外部命令：是文件系统中的一个可执行程序，执行需要 fork + exec 来创建新进程，如 ls、grep、cat 等

### 命令提示符

```shell
[username]@[hostname] [path][symbol] [command]
```

命令提示符不属于命令的一部分，而是 Shell 解析当前环境变量展示的提示性信息

- username：当前登陆用户名，提示是哪个用户
- hostname：当前主机名，提示是哪个机器
- path：当前工作目录路径，提示命令在哪儿执行
- symbol：当前身份，$ 表示普通用户，# 表示超级用户，提示命令的权限级别？

### 格式

```shell
[command] [options] ([options_value]) [arguments]
```

命令必须按照规定格式编写才能被 Shell 解析执行，不过现代命令的格式更加丰富

- 命令 command：要执行的命令名称
- 选项 options：用于修改命令的行为，以 `-` 或者 `--` 开头
    - 可以在一个命令中提供多个选项
    - 有些选项是没有选项值的
    - 有些选项是可以不提供选项值的（使用默认值）
    - 有些选项是必须提供选项值的
    - 选项值必须紧跟在对应选项后面
- 参数 arguments：用于指定命令作用的对象，作为命令程序的传参

### 执行过程

1. 终端把用户键盘输入的命令传递给 Shell
2. Shell 对命令做词法分析和语法分析，解析出命令名、选项、选项值和参数，并处理变量替换、通配符展开等
3. 如果是内建命令，则直接在当前进程调用内部函数执行；如果是外部命令，则根据环境变量 PATH 指定的目录列表中按顺序查找同名可执行文件
4. Shell 会调用 fork() 创建一个子进程，然后调用 execve() 加载并执行目标 ELF 文件
5. Shell 调用 wait() 等待子进程执行完毕，并把输出结果返回到 Terminal
6. 终端把命令的执行结果打印到屏幕



## 文件系统

### 文件信息

Linux 设计的一个宗旨是**让一切皆为文件（Everything is a file）**，即将所有资源都抽象为文件的方式，从而实现了一种统一的文件操作方式

通过 `ls -l filename` 可以查看目录下所有文件或单个文件的基础元信息，按顺序分别为

1. 文件类型
  | **文件类型**     | **含义**                                               | **在** ls -l **中的标识** |
  | ---------------- | ------------------------------------------------------ | ------------------------- |
  | **普通文件**     | 存放实际数据内容（文本、二进制、程序等）               | -                         |
  | **目录文件**     | 存放目录项：filename → inode number 的映射             | d                         |
  | **符号链接文件** | 保存另一个文件路径                                     | l                         |
  | **块设备文件**   | 访问以“块”为单位的设备，如磁盘、SSD、U 盘              | b                         |
  | **字符设备文件** | 访问以“字节流”为单位的设备，如键盘、鼠标、打印机、屏幕 | c                         |
  | **命名管道文件** | 支持进程间的直接通信                                   | p                         |
  | **套接字文件**   | 支持进程间的网络通信                                   | s                         |

2. 文件权限：三个为一组，分别为 **user、group、others**，如果存在权限则显示字母，如果没有权限则显示 `-`

    - 对于文件：r 表示可以使用 cat 查看文件内容，w 表示可以修改文件内容，x 表示可以作为二进制文件运行
    - 对于目录：r 表示可以查看目录下文件列表，w 表示可以创建和删除目录下文件，x 表示可以使用 cd 进入目录

3. 硬链接数：表示有多少个目录条目指向这个文件

4. 属主：创建该文件的用户

5. 属组：创建该文件的用户所属的用户组

6. 文件大小：单位是字节

7. 最后修改时间：显示月+日+时间/年份（如果修改时间离当前时间超过半年，会显示年份替代时间）

8. 文件名：文件名称，如果是符号链接，后面会有 `->` 指向目标路径

### 目录结构

Linux 文件系统采用单一根目录结构，也就是说**所有文件都挂载在根目录之下，构成一棵倒立的树**

- /：根目录，所有文件系统的起点
- /bin：存放基本用户命令
- /sbin：存放超级用户命令
- /dev：存放设备文件
- /etc：存放系统的全局配置文件
- /lib：存放系统运行所需的共享库文件
- /opt：存放第三方安装的应用程序
- /usr：存放发行版自带和包管理工具安装的应用程序
- /home：普通用户的主目录
- /root：超级用户的主目录
- /tmp：存放临时文件，系统重启后会清空
- /var：存放经常变化的数据，如日志、缓存等



## 环境变量

### 定义

环境变量是操作系统在运行时维护的**一组键值对，用于记录当前进程的运行环境信息**，并在父子进程间通过继承机制传递。需要注意的是，每个进程都维护了一份环境变量的副本，修改只会影响当前进程，不会影响其他进程

- PATH：命令搜索路径列表，之间用 `:` 分隔
- LANG：系统默认语言与字符编码设置
- SHELL：当前使用外壳的存储路径
- USER：当前登陆用户名
- HOME：当前用户的主目录
- PWD：当前工作目录
- CC：当前使用 C 编译器的名称或存储路径
- CXX：当前使用 C++ 编译器的名称或存储路径
- PYTHONHOME：当前使用 PYTHON 解释器的存储路径
- JAVA_HOME：当前使用 JDK 的存储路径

### 存储位置

- 系统级：`/etc/environment`、`/etc/profile`、`/etc/profile.d`、`/etc/bashrc`
- 用户级：`~/.bashrc`、`~/.bash_profile`

### 相关命令

- 显示当前进程的所有环境变量：`env`
- 查看具体的单个环境变量：`echo $VAR`
- 设置环境变量，当前 shell 及其子进程都可见：`export VAR=value`
- 删除环境变量：`unset VAR`
- 重新加载环境变量：`source ~/.bashrc`



## 基本命令

### 文件管理

#### ls

list：展现文件或目录信息

```bash
ls [options] [filename]
```
|选项|全称|说明|
|--|--|--|
|-l|--format=long|完整显示，包含权限、所有者、大小、修改时间等详细信息|
|-a|--all|显示所有文件，包括隐藏文件（以.开头）|
|-h|--human-readable|文件大小以 KB、MB、GB 显示|
|-t|--sort=time|按修改时间排序，默认新文件在前|
|-r|--reverse|反转排序结果，配合-t 时让旧文件在前|
|-R|--recursive|递归显示子目录内容|

#### cd

change directory：切换目录

```bash
cd [path]
```
|path 形式|说明|
|--|--|
|空|切换到当前用户的主目录|
|~|切换到当前用户的主目录|
|/|切换到根目录|
|..|返回上级目录|
|../..|返回上上级目录|
|-|返回上一次所在目录|
|path|进入相对路径|
|/path|进入绝对路径|

#### rm

remove：删除文件或目录

```bash
rm [options] [filename]
```

|选项|作用|
|--|--|
|-i|交互模式，提示是否确认删除|
|-r|递归删除目录及其内容|
|-f|强制删除，不提示确认|
|-rf|递归+强制，删除一切|

#### cp

copy：复制文件到指定目录下

```shell
cp [options] [source1 source2 ...] [destination]
```
|选项|作用|
|--|--|
|-r|递归复制目录及其内容|
|-i|交互模式，覆盖前提示确认|
|-f|强制覆盖，覆盖不提示确认|
|-n|禁止覆盖已有文件|
|-u|仅当源文件比目标文件新时才复制|

#### touch

touch：创建文件或者修改文件时间戳

```bash
touch [options] [filename] # 
```

|选项|作用|
|--|--|
|无|创建新文件|
|-d|指定字符串来更新，如 "2023-04-11 12:00:00"|
|-t|指定时间戳来更新，如 202304111200.00|
|-r|指定另一个文件的时间戳来更新|

#### mv

move：移动文件或者重命名文件

```shell
mv [options] [old_filename] [new_filename/dirname]
```
|选项|作用|
|--|--|
|-i|交互模式，覆盖前提示确认|
|-f|强制覆盖，覆盖前不提示|
|-n|禁止覆盖已有文件|

### 文本管理

#### cat

concatenate：连接并打印文件内容

```bash
cat [options] [filename]
```

| **选项** | **说明**                             |
| -------- | ------------------------------------ |
| 无       | 按顺序输出文件内容到标准输出（终端） |
| -n       | 对所有输出行编号                     |
| -b       | 只对非空行编号                       |
| -s       | 压缩连续空行为一行                   |
| -E       | 在每行结尾显示 $                     |

#### grep

global regular expression print：搜索文件中符合正则表达式的内容

```bash
grep [options] "pattern" [file]
```

| **选项** | **说明**                   |
| -------- | -------------------------- |
| -i       | 忽略大小写                 |
| -n       | 显示匹配行的行号           |
| -v       | 反向匹配（显示未匹配的行） |
| -r       | 递归搜索目录下的所有文件   |
| -E       | 使用扩展正则表达式         |
| -A n     | 显示匹配行后 n 行          |
| -B n     | 显示匹配行前 n 行          |
| -C n     | 显示匹配行前后各 n 行      |

#### sort

sort：对文本行进行排序

```bash
sort [options] [file]
```

| **选项** | **说明**                     |
| -------- | ---------------------------- |
| 无       | 按字典序（ASCII）排序        |
| -r       | 反向排序（从大到小）         |
| -n       | 按数值大小排序               |
| -k n     | 按第 n 列排序                |
| -t c     | 指定列分隔符，默认以空格分隔 |
| -u       | 去重，相邻重复行只保留一行   |
| -o file  | 将结果输出到指定文件         |

#### wc

word count：统计文件的行数、单词数和字节数

```bash
wc [options] [file]
```

| **选项** | **说明**                     |
| -------- | ---------------------------- |
| 无       | 依次输出行数、单词数、字节数 |
| -l       | 仅统计行数                   |
| -w       | 仅统计单词数                 |
| -c       | 仅统计字节数                 |
| -m       | 按字符统计（区别多字节字符） |

### 权限管理

#### chmod

change mode：修改文件或目录的权限

```bash
chmod [options] mode [file]
```

- 数字法：**r = 4，w = 2，x = 1**，用整数和给每个组设置权限
- 符号法：u 表示用户，g 表示用户组，o 表示其他，+ 表示添加权限，- 表示删除权限，= 表示设置权限

#### chown

change owner：修改文件或目录的所属用户和用户组

```bash
chown [options] [user][:group] fil
```

| **选项** | **说明**                       |
| -------- | ------------------------------ |
| -R       | 递归修改目录及子目录下所有文件 |

#### umask

user file creation mask：设置新建文件或目录的默认权限掩码

```bash
umask [mask]
```

| **umask 值** | **文件默认权限** | **目录默认权限** | **含义**       |
| ------------ | ---------------- | ---------------- | -------------- |
| 0000         | 666              | 777              | 所有都可写     |
| 0022         | 644              | 755              | 仅自己可写     |
| 0002         | 664              | 775              | 组内可读写     |
| 0077         | 600              | 700              | 仅自己可读和写 |

### 用户管理

#### useradd

user add：创建用户账号

```bash
useradd [options] username
```

| **选项**  | **说明**                             |
| --------- | ------------------------------------ |
| -m        | 自动创建用户主目录（/home/username） |
| -d DIR    | 指定主目录路径                       |
| -s SHELL  | 指定登录 Shell（如 /bin/bash）       |
| -g GROUP  | 指定初始所属用户组                   |
| -G GROUPS | 指定附加用户组（可多个）             |

#### userdel

user delete：删除用户账号

```bash
userdel [options] username
```

| **选项** | **说明**                     |
| -------- | ---------------------------- |
| 无       | 删除用户账号，但保留主目录   |
| -r       | 删除用户及其主目录和邮件队列 |

#### usermod

user modify：修改现有用户属性

```bash
usermod [options] username
```

| **选项**   | **说明**                       |
| ---------- | ------------------------------ |
| -l NEW     | 修改用户名                     |
| -d DIR     | 修改主目录                     |
| -s SHELL   | 修改登录 Shell                 |
| -g GROUP   | 修改主组                       |
| -G GROUPS  | 修改附加组（会覆盖原有附加组） |
| -aG GROUPS | 添加附加组（保留已有组）       |

#### passwd

password：设置或修改用户密码

```bash
passwd [username]
```

| **选项** | **说明**                         |
| -------- | -------------------------------- |
| 无       | 修改当前用户密码                 |
| username | 修改指定用户密码（需 root 权限） |

### 用户组管理

#### groupadd

group add：创建用户组

```bash
groupadd [options] groupname
```

| **选项** | **说明**      |
| -------- | ------------- |
| -g GID   | 指定组 ID     |
| 无       | 自动分配组 ID |

#### groupdel

group delete：删除用户组

```bash
groupdel groupname
```

#### groupmod

group modify：修改用户组

```bash
groupmod [options] [groupname]
```

| 选项      | 说明                                    |
| --------- | --------------------------------------- |
| -n 新组名 | 修改组名称                              |
| -g 新 GID | 修改组的 ID（不推荐修改已广泛使用的组） |

### 进程管理

#### kill

kill：向进程发送信号

```bash
kill [options] [pid]
```

| **选项** | **说明**                 |
| -------- | ------------------------ |
| -l       | 显示所有可用信号名及编号 |
| -9       | 发送 SIGKILL：强制终止   |
| -15      | 发送 SIGTERM：请求终止   |
| -HUP     | 发送 SIGHUP：挂起信号    |
| -INT     | 发送 SIGINT：中断信号    |
| -STOP    | 发送 SIGSTOP：暂停信号   |
| -CONT    | 发送 SIGCONT：恢复信号   |

#### ps

process status：显示当前系统进程状态快照

```bash
ps [options]
```

| **选项** | **说明**                              |
| -------- | ------------------------------------- |
| -e       | 显示所有进程                          |
| -f       | 全格式显示：含 UID、PID、时间、命令等 |
| -u user  | 按用户显示进程                        |

#### systemctl

system control：控制和管理 systemd 系统及其服务

```bash
systemctl [options] [command] [unit]
```

| 命令        | 说明             |
| ----------- | ---------------- |
| start       | 启动服务         |
| stop        | 停止服务         |
| restart     | 重启服务         |
| reload      | 重新加载配置文件 |
| status      | 查看服务状态     |
| enable      | 开启开机自启     |
| disbale     | 关闭开机自启     |
| mask        | 禁止服务         |
| unmask      | 允许服务         |
| poweroff    | 关机             |
| reboot      | 重启             |
| suspend     | 睡眠             |
| halt        | 中止             |
| set-default | 设置默认运行级别 |
| get-default | 查看默认运行级别 |
| isolate     | 切换当前运行级别 |



## 软件包管理

### 格式

如果是 Debian 系列则命令为 apt；如果是 Red Hat 系列命令为 dnf

```bash
sudo dnf [options] [command] [package1 package2 ...]
```

### 选项

|选项|功能|
|--|--|
|-y|自动回答 “yes”，无需人工确认|
|-q|静默模式，减少输出信息|
|-v|显示详细信息|
|-allowerasing|允许安装时移除冲突包|
|-best|安装最高版本的包|
|-nobest|安装兼容的版本|
|- skip-broken|忽略无法解决依赖的软件包|

### 命令

| **命令**     | **作用说明**           |
| ------------ | ---------------------- |
| install      | 安装软件包             |
| remove       | 卸载软件包             |
| groupinstall | 安装软件组             |
| groupremove  | 卸载软件组             |
| update       | 更新软件包             |
| info         | 查看软件包信息         |
| list         | 列举软件包             |
| search       | 查询包含关键字的软件包 |
| check-update | 查看可更新的软件包     |
| autoremove   | 删除无用依赖包         |



## 系统信息查询

| 命令     | 功能                                           |
| -------- | ---------------------------------------------- |
| uname -a | 显示内核名称、版本、主机名、CPU 架构等系统信息 |
| uptime   | 显示系统运行时间                               |
| date     | 显示系统当前日期和时间                         |
| whoami   | 显示当前用户名称                               |
| pwd      | 显示当前工作目录                               |
| id       | 显示当前用户的 UID、GID 信息                   |
| top      | 显示系统进程信息                               |
| lscpu    | 显示 CPU 架构信息                              |
| ifconfig | 显示网络接口信息                               |
| free -h  | 显示系统内存使用情况                           |
| df -h    | 显示各分区磁盘空间使用情况                     |